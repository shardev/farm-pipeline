version: 2

models:
  - name: mart_coverage_map
    description: |
      This model calculates the convex hull (coverage map) for each vehicle run based on the GPS telemetry data and vehicle run assignments. It joins telemetry data with vehicle run details to produce the coverage area for each run.
    columns:
      - name: vehicleid
        description: |
          The unique identifier for each vehicle. This column represents which vehicle the GPS points belong to.
        tests:
          - not_null

      - name: run_number_for_machine
        description: |
          The run number assigned to each machine (vehicle). This denotes a specific operation session for the vehicle.
        tests:
          - not_null

      - name: timestart
        description: |
          The timestamp representing the start of the vehicle's operation run.
        tests:
          - not_null

      - name: timeend
        description: |
          The timestamp representing the end of the vehicle's operation run.
        tests:
          - not_null

      - name: coveragemap
        description: |
          The geographic area (convex hull) that represents the field covered by the vehicle during the run. This is a POLYGON or MULTIPOLYGON generated by aggregating all the GPS points for a specific run.

tests:
  - name: relationships
    description: |
      Tests to ensure that the foreign keys in this model correctly reference the primary keys in the relevant models.
    relationships:
      - column_name: vehicleid
        to: ref('int_telemetry__common_structure')
        field: vehicleid
      - column_name: run_number_for_machine
        to: ref('int_vehicle_runs__aggregation')
        field: run_number_for_machine
